name: Getin Sync Continuous

on:
  schedule:
    # Roda a cada 4 horas (00:00, 04:00, 08:00, 12:00, 16:00, 20:00 UTC)
    - cron: '0 */4 * * *'
  
  # Permite execu√ß√£o manual
  workflow_dispatch:

jobs:
  sync-getin:
    runs-on: ubuntu-latest
    name: Sincronizar Reservas Getin
    
    steps:
      - name: Trigger Getin Sync
        run: |
          echo "üöÄ Iniciando sincroniza√ß√£o Getin..."
          
          response=$(curl -s -w "%{http_code}" -X POST \
            "${{ secrets.SUPABASE_FUNCTION_URL }}/getin-sync-continuous" \
            -H "Content-Type: application/json")
          
          http_code="${response: -3}"
          body="${response%???}"
          
          echo "üìä Status HTTP: $http_code"
          
          if [ "$http_code" -eq 200 ]; then
            echo "‚úÖ Sincroniza√ß√£o conclu√≠da com sucesso!"
            echo "üìã Resposta: $body"
          else
            echo "‚ùå Erro na sincroniza√ß√£o (HTTP $http_code)"
            echo "üìã Resposta: $body"
            exit 1
          fi
          
      - name: Notify on failure
        if: failure()
        run: |
          echo "‚ùå Falha na sincroniza√ß√£o do Getin"
          echo "‚è∞ Hor√°rio: $(date)"
          # Aqui voc√™ pode adicionar notifica√ß√£o via Discord, Slack, etc.
